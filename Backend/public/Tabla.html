<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="EstilosAIRz.css">
    <link rel="icon" href="../Assets/LogoZyoniaDos.png">
    <title>Ingresar Datos</title>
</head>
<body>
    <!-- Navbar -->
    <nav>
        <div class="logo">
            <img src="../Assets/LogoZyoniaTres.png" alt="Logo AIRz">
        </div>
        <div class="language-selector">
            <label for="language"><img src="../Assets/Idioma.png" class="idioma" alt="Logo AIRz"></label>
            <select id="language" name="language">
                <option value="es">Español</option>
                <option value="en">English</option>
            </select>
        </div>
    </nav>

    <!-- Contenedor de la tabla -->
    <div class="login-container">
        <div class="logo">
            <h1>AIRz</h1>
        </div>
        <div class="title">Ingresar Datos</div>
        <div class="subtitle">Rellena la tabla con los datos necesarios</div>

        <!-- Tabla -->
        <div class="table-container">
            <table class="data-entry-table">
                <tr>
                    <td><label for="nombre_vivienda">Nombre de vivienda</label></td>
                    <td><input type="text" id="nombre_vivienda" name="nombre_vivienda" required></td>
                </tr>
                <tr>
                    <td><label for="tipo_vivienda">Tipo de vivienda</label></td>
                    <td><input type="text" id="tipo_vivienda" name="tipo_vivienda" required></td>
                </tr>
                <tr>
                    <td><label for="estado">Estado</label></td>
                    <td><input type="text" id="estado" name="estado" required></td>
                </tr>
                <tr>
                    <td><label for="habitaciones">Habitaciones</label></td>
                    <td><input type="number" id="habitaciones" name="habitaciones" required></td>
                </tr>
                <tr>
                    <td><label for="banos">Baños</label></td>
                    <td><input type="number" id="banos" name="banos" required></td>
                </tr>
                <tr>
                    <td><label for="muebles">Muebles</label></td>
                    <td><input type="text" id="muebles" name="muebles" required></td>
                </tr>
                <tr>
                    <td><label for="precio">Precio</label></td>
                    <td><input type="number" id="precio" name="precio" required></td>
                </tr>
                <tr>
                    <td><label for="superficie_total">Superficie total</label></td>
                    <td><input type="number" id="superficie_total" name="superficie_total" required></td>
                </tr>
                <tr>
                    <td><label for="superficie_util">Superficie útil</label></td>
                    <td><input type="number" id="superficie_util" name="superficie_util" required></td>
                </tr>
                <tr>
                    <td><label for="precio_metro_cuadrado">Precio por metro cuadrado</label></td>
                    <td><input type="number" id="precio_metro_cuadrado" name="precio_metro_cuadrado" required></td>
                </tr>
                <tr>
                    <td><label for="certificado_energetico">Certificado energético</label></td>
                    <td><input type="text" id="certificado_energetico" name="certificado_energetico" required></td>
                </tr>
                <tr>
                    <td><label for="anio_construccion">Año de construcción</label></td>
                    <td><input type="number" id="anio_construccion" name="anio_construccion" required></td>
                </tr>
                <tr>
                    <td><label for="ubicacion_calle">Ubicación: calle y número</label></td>
                    <td><input type="text" id="ubicacion_calle" name="ubicacion_calle" required></td>
                </tr>
                <tr>
                    <td><label for="ubicacion_piso">Ubicación: Piso y número, letra o portal</label></td>
                    <td><input type="text" id="ubicacion_piso" name="ubicacion_piso" required></td>
                </tr>
                <tr>
                    <td><label for="codigo_postal">Código Postal</label></td>
                    <td><input type="text" id="codigo_postal" name="codigo_postal" required></td>
                </tr>
                <tr>
                    <td><label for="localidad">Localidad</label></td>
                    <td><input type="text" id="localidad" name="localidad" required></td>
                </tr>
                <tr>
                    <td><label for="provincia">Provincia</label></td>
                    <td><input type="text" id="provincia" name="provincia" required></td>
                </tr>
                <tr>
                    <td><label for="distrito">Distrito</label></td>
                    <td><input type="text" id="distrito" name="distrito" required></td>
                </tr>
                <tr>
                    <td><label for="barrio">Barrio</label></td>
                    <td><input type="text" id="barrio" name="barrio" required></td>
                </tr>
                <tr>
                    <td><label for="gastos_comunidad">Gastos de la comunidad</label></td>
                    <td><input type="number" id="gastos_comunidad" name="gastos_comunidad" required></td>
                </tr>
                <tr>
                    <td><label for="calefaccion">Calefacción</label></td>
                    <td><input type="text" id="calefaccion" name="calefaccion" required></td>
                </tr>
                <tr>
                    <td><label for="garage">Garage</label></td>
                    <td><input type="text" id="garage" name="garage" required></td>
                </tr>
                <tr>
                    <td><label for="trastero">Trastero</label></td>
                    <td><input type="text" id="trastero" name="trastero" required></td>
                </tr>
                <tr>
                    <td><label for="balcon_terraza">Balcón y terraza</label></td>
                    <td><input type="text" id="balcon_terraza" name="balcon_terraza" required></td>
                </tr>
                <tr>
                    <td><label for="piscina">Piscina</label></td>
                    <td><input type="text" id="piscina" name="piscina" required></td>
                </tr>
                <tr>
                    <td><label for="jardin">Jardín</label></td>
                    <td><input type="text" id="jardin" name="jardin" required></td>
                </tr>
                <tr>
                    <td><label for="planta">Planta</label></td>
                    <td><input type="text" id="planta" name="planta" required></td>
                </tr>
                <tr>
                    <td><label for="ascensor">Ascensor</label></td>
                    <td><input type="text" id="ascensor" name="ascensor" required></td>
                </tr>
                <tr>
                    <td><label for="orientacion">Orientación</label></td>
                    <td><input type="text" id="orientacion" name="orientacion" required></td>
                </tr>
                <tr>
                    <td><label for="nota_agente">Nota del agente</label></td>
                    <td><textarea maxlength="300" id="nota_agente" name="nota_agente" required></textarea></td>
                </tr>
                
                <tr>
                    <td><label for="fotografias">Fotografías</label></td>
                    <td><input type="file" id="fotografias" name="fotografias" accept="image/*" multiple required></td>
                </tr>
                <!-- Para futuras actualizaciones
                <tr>
                    <td><label for="video">Video</label></td>
                    <td><input type="file" id="video" name="video" accept="video/*" required></td>
                </tr>
                -->
            </table>
        </div>
        <div id="notification-container"></div>
        <button type="submit" class="btn">Guardar Datos</button>
        <div class="footer">
            <a href="GestionTablas.html">Gestionar Tablas</a>
        </div>
    </div>
    <script>
        document.querySelector('.btn').addEventListener('click', async (event) => {
          event.preventDefault();
      
          const formData = {
            NombreVivienda: document.getElementById('nombre_vivienda').value,
            TipoVivienda: document.getElementById('tipo_vivienda').value,
            Estado: document.getElementById('estado').value,
            Habitaciones: parseInt(document.getElementById('habitaciones').value),
            Baños: parseInt(document.getElementById('banos').value),
            Muebles: document.getElementById('muebles').value,
            Precio: parseFloat(document.getElementById('precio').value),
            SuperficieTotal: parseFloat(document.getElementById('superficie_total').value),
            SuperficieUtil: parseFloat(document.getElementById('superficie_util').value),
            PrecioPorMetroCuadrado: document.getElementById('precio_metro_cuadrado').value,
            CertificadoEnergetico: document.getElementById('certificado_energetico').value,
            AñoConstruccion: parseInt(document.getElementById('anio_construccion').value),
            UbicacionCalle: document.getElementById('ubicacion_calle').value,
            UbicacionPiso: document.getElementById('ubicacion_piso').value,
            CodigoPostal: document.getElementById('codigo_postal').value,
            Localidad: document.getElementById('localidad').value,
            Provincia: document.getElementById('provincia').value,
            Distrito: document.getElementById('distrito').value,
            Barrio: document.getElementById('barrio').value,
            GastosComunidad: parseFloat(document.getElementById('gastos_comunidad').value),
            Calefaccion: document.getElementById('calefaccion').value,
            Garage: document.getElementById('garage').value,
            Trastero: document.getElementById('trastero').value,
            BalconTerraza: document.getElementById('balcon_terraza').value,
            Piscina: document.getElementById('piscina').value,
            Jardin: document.getElementById('jardin').value,
            Planta: document.getElementById('planta').value,
            Ascensor: document.getElementById('ascensor').value,
            Orientacion: document.getElementById('orientacion').value,
            NotaAgente: document.getElementById('nota_agente').value
          };
      
          try {
            localStorage.setItem('tablaDatos', JSON.stringify(formData));
    alert('Datos guardados exitosamente en el caché');
            const response = await fetch('http://localhost:5000/api/datos/registrocasa', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(formData),
            });
      
            if (response.ok) {
              alert('Datos guardados exitosamente');
            } else {
              alert('Error al guardar los datos');
            }
          } catch (error) {
            console.error('Error:', error);
            alert('Error al enviar los datos');
          }
        });
        // Función para mostrar notificaciones
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.style.backgroundColor = '#f44336'; // Rojo para errores
            }

            notification.textContent = message;
            container.appendChild(notification);

            // Eliminar notificación después de 5 segundos
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        document.querySelector('.btn').addEventListener('click', async (event) => {
            event.preventDefault();

            const formData = {
                // Tu lógica de recolección de datos...
            };

            try {
                localStorage.setItem('tablaDatos', JSON.stringify(formData));
                showNotification('Datos guardados exitosamente en el caché');
                
                const response = await fetch('http://localhost:5000/api/datos/registrocasa', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });

                if (response.ok) {
                    showNotification('Datos guardados exitosamente');
                } else {
                    showNotification('Error al guardar los datos', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error al enviar los datos', 'error');
            }
        });

      </script>
      
    <!-- Footer -->
    <footer>© Zyonia SL 2024</footer>
</body>
</html>